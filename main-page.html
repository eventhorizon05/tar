<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tap And Repair</title>
    <link rel="stylesheet" href="bootstrap.css">
    <script src="bootstrap.js"></script>
    <script src="jquery.js"></script>
</head>
<script>
    $(document).ready(function(){
        //hidden parts
        $('#approvedUserSection,#mechanicsSection,#requestMechanicsSection,#shopOwnersSection,#shopOwnersRequestSection').hide();
        
        var loadingScreen = $('.loadingScreen');
        
        $.ajax({
            type: 'GET',
            url: 'php/sessioncheck.php',
            success:function(response){
                if( response == 'index.html'){
                    loadingScreen.slideDown('fast', function(){
                        window.location.replace(response);
                    });
                }
            }
        });
        
        var logoutButton = $('#logOut');
        var userSection = $('#userSection');
        var mechanicsSection = $('#mechanicsSection');
        var approvedUserSection = $('#approvedUserSection');
        var requestMechanicsSection = $('#requestMechanicsSection');
        var shopOwnersRequestSection = $('#shopOwnersRequestSection');
        var shopOwnersSection = $('#shopOwnersSection');
        var requestMechanicsTable = $('#requestMechanicsTable');
        var userTable = $('#userTable');
        var approvedShopOwnersTable = $('#approvedShopOwnersTable');
        var shopOwnersRequestTable = $('#shopOwnersRequestTable');
        var approvedUsersTable = $('#approvedUserTable');
        var approvedMechanicsTable = $('#approvedMechanicsTable');
        var navApprovedAccounts = $('#navApprovedAccounts');
        var navAccountRequests = $('#navAccountRequests');
        var navRequestMechanics = $('#navRequestMechanics');
        var navMechanics = $('#navMechanics');
        var navShopOwners = $('#navShopOwners');
        var navShopOwnersRequests = $('#navShopOwnersRequests');
        var globalProductId = 0;
        var userFirstNameEdit = $('#userFirstNameEdit');
        var userLastNameEdit = $('#userLastNameEdit');
        var userEmailEdit = $('#userEmailEdit');
        var userContactNumberEdit = $('#userContactNumberEdit');
        var userNameUpdateBtn = $('#userNameUpdateBtn');
        var userEmailUpdateBtn = $('#userEmailUpdateBtn');
        var userContactNumberUpdateBtn = $('#userContactNumberUpdateBtn');
        var updateApprovedUserModal = $('#updateApprovedUserModal');
        var mechanicFirstNameEdit = $('#mechanicFirstNameEdit');
        var mechanicLastNameEdit = $('#mechanicLastNameEdit');
        var mechanicNameUpdateBtn = $('#mechanicNameUpdateBtn');
        var mechanicEmailEdit = $('#mechanicEmailEdit');
        var mechanicEmailUpdateBtn = $('#mechanicEmailUpdateBtn');
        var mechanicContactNumberEdit = $('#mechanicContactNumberEdit');
        var mechanicContactNumberUpdateBtn = $('#mechanicContactNumberUpdateBtn');
        var updateApprovedMechanicsModal = $('#updateApprovedMechanicsModal');
        var ownerFirstNameEdit = $('#ownerFirstNameEdit');
        var ownerLastNameEdit = $('#ownerLastNameEdit');
        var ownerEmailEdit = $('#ownerEmailEdit');
        var ownerContactNumberEdit = $('#ownerContactNumberEdit');
        var ownerNameUpdateBtn = $('#ownerNameUpdateBtn');
        var ownerEmailUpdateBtn = $('#ownerEmailUpdateBtn');
        var ownerContactNumberUpdateBtn = $('#ownerContactNumberUpdateBtn');
        var updateApprovedShopOwnerModal = $('#updateApprovedShopOwnerModal');
        var badgeSO = $('#badgeSO');
        var inboxSO = 0;
        var badgeM = $('#badgeM');
        var inboxM = 0;
        var badgeU = $('#badgeU');
        var inboxU = 0;
        
        
        ownerFirstNameEdit.on('keydown',function(){
            $(this).removeClass('is-invalid');
        });
        ownerLastNameEdit.on('keydown',function(){
            $(this).removeClass('is-invalid');
        });
        ownerEmailEdit.on('keydown',function(){
            $(this).removeClass('is-invalid');
        });
        ownerContactNumberEdit.on('keydown',function(){
            $(this).removeClass('is-invalid');
        });
        ownerNameUpdateBtn.click(function(){
            if(ownerFirstNameEdit.val() == ""){
                ownerFirstNameEdit.addClass('is-invalid');
            }
            if(ownerLastNameEdit.val() == ""){
                ownerLastNameEdit.addClass('is-invalid');
            }
            if(!ownerFirstNameEdit.hasClass('is-invalid') && !ownerLastNameEdit.hasClass('is-invalid')){
                if(confirm('Update Name?') == true){
                    loadingScreen.show();
                    updateApprovedShopOwnerModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateOwnerName.php',
                        data:
                        {
                            requestId: globalProductId,
                            first_name: ownerFirstNameEdit.val(),
                            last_name: ownerLastNameEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                ownerFirstNameEdit.val("");
                                ownerLastNameEdit.val("");
                                approvedShopOwnersTable.children().remove();
                                getShopOwners();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!');
                                })
                            }
                        }
                    });
                }
            }
        });
        ownerEmailUpdateBtn.click(function(){
            if(ownerEmailEdit.val() == ""){
                ownerEmailEdit.addClass('is-invalid');
            }
            if(!ownerEmailEdit.hasClass('is-invalid')){
                if(confirm('Update Email?') == true){
                    loadingScreen.show();
                    updateApprovedShopOwnerModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateOwnerEmail.php',
                        data:
                        {
                            requestId: globalProductId,
                            email: ownerEmailEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                ownerEmailEdit.val("");
                                approvedShopOwnersTable.children().remove();
                                getShopOwners();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!');
                                })
                            }
                        }
                    });
                }
            }
        });
        ownerContactNumberUpdateBtn.click(function(){
            if(ownerContactNumberEdit.val() == "" || ownerContactNumberEdit.val().charAt(0) != '0' || ownerContactNumberEdit.val().charAt(1) != '9' || ownerContactNumberEdit.val().length != 11){
                ownerContactNumberEdit.addClass('is-invalid');
            }
            if(!ownerContactNumberEdit.hasClass('is-invalid')){
                if(confirm('Update Contact Number') == true){
                    loadingScreen.show();
                    updateApprovedShopOwnerModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateOwnerContactNumber.php',
                        data:
                        {
                            requestId: globalProductId,
                            contact_number: ownerContactNumberEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                ownerContactNumberEdit.val("");
                                approvedShopOwnersTable.children().remove();
                                getShopOwners();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!');
                                })
                            }
                        }
                    });
                }
            }
        });
        
        mechanicFirstNameEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        mechanicLastNameEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        mechanicEmailEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        mechanicContactNumberEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        mechanicNameUpdateBtn.click(function(){
            if(mechanicFirstNameEdit.val() == ""){
                mechanicFirstNameEdit.addClass('is-invalid');
            }
            if(mechanicLastNameEdit.val() == ""){
                mechanicLastNameEdit.addClass('is-invalid');
            }
            if(!mechanicFirstNameEdit.hasClass('is-invalid') && !mechanicLastNameEdit.hasClass('is-invalid')){
                if(confirm('Update Name?') == true){
                    loadingScreen.show();
                    updateApprovedMechanicsModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateMechanicName.php',
                        data:
                        {
                            requestId: globalProductId,
                            first_name: mechanicFirstNameEdit.val(),
                            last_name: mechanicLastNameEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                mechanicFirstNameEdit.val("");
                                mechanicLastNameEdit.val("");
                                approvedMechanicsTable.children().remove();
                                getMechanics();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!');
                                })
                            }
                        }
                    });
                }
            }
        });
        mechanicEmailUpdateBtn.click(function(){
            if(mechanicEmailEdit.val() == ""){
                mechanicEmailEdit.addClass('is-invalid');
            }
            if(!mechanicEmailEdit.hasClass('is-invalid')){
                if(confirm('Update Email Number') == true){
                    loadingScreen.show();
                    updateApprovedMechanicsModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateMechanicEmail.php',
                        data:
                        {
                            requestId: globalProductId,
                            email: mechanicEmailEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                mechanicEmailEdit.val("");
                                approvedMechanicsTable.children().remove();
                                getMechanics();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!')
                                });
                            }
                        }
                    });
                }
            }
        });
        mechanicContactNumberUpdateBtn.click(function(){
            if(mechanicContactNumberEdit.val() == "" || mechanicContactNumberEdit.val().charAt(0) != '0' || mechanicContactNumberEdit.val().charAt(1) != '9' || mechanicContactNumberEdit.val().length != 11){
                mechanicContactNumberEdit.addClass('is-invalid');
            }
            if(!mechanicContactNumberEdit.hasClass('is-invalid')){
                if(confirm('Update Contact number?') == true){
                    loadingScreen.show();
                    updateApprovedMechanicsModal.modal('hide');
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateMechanicContactNumber.php',
                        data:
                        {
                            requestId: globalProductId,
                            contact_number: mechanicContactNumberEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                mechanicContactNumberEdit.val("");
                                approvedMechanicsTable.children().remove();
                                getMechanics();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!')
                                });
                            }
                        }
                    });
                }
            }
        });
        
        userFirstNameEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        userLastNameEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        userEmailEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        userContactNumberEdit.on('keydown', function(){
            $(this).removeClass('is-invalid');
        });
        
        userNameUpdateBtn.click(function(){
            if(userFirstNameEdit.val() == ""){
                userFirstNameEdit.addClass('is-invalid');
            }
            if(userLastNameEdit.val() == ""){
                userLastNameEdit.addClass('is-invalid');
            }
            if(userFirstNameEdit.val() && userLastNameEdit.val() != ""){
                if(confirm('Update Name?') == true){
                    updateApprovedUserModal.modal('hide');
                    loadingScreen.show();
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateUserName.php',
                        data:
                        {
                            requestId: globalProductId,
                            first_name: userFirstNameEdit.val(),
                            last_name: userLastNameEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                userFirstNameEdit.val("");
                                userLastNameEdit.val("");
                                approvedUsersTable.children().remove();
                                getApprovedUsers();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!')
                                });
                            }
                        }
                    });
                }
            }
        });
        userEmailUpdateBtn.click(function(){
            if(userEmailEdit.val() == ""){
                userEmailEdit.addClass('is-invalid');
            }
            if(userEmailEdit.val() != ""){
                if(confirm('Update Email?') == true){
                    updateApprovedUserModal.modal('hide');
                    loadingScreen.show();
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateUserEmail.php',
                        data:
                        {
                            requestId: globalProductId,
                            email: userEmailEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                userEmailEdit.val("");
                                approvedUsersTable.children().remove();
                                getApprovedUsers();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!')
                                });
                            }
                        }
                    });
                }
            }
        });
        userContactNumberUpdateBtn.click(function(){
            if(userContactNumberEdit.val() == "" || userContactNumberEdit.val().charAt(0) != '0' || userContactNumberEdit.val().charAt(1) != '9' || userContactNumberEdit.val().length != 11){
                userContactNumberEdit.addClass('is-invalid');
            }
            if(userContactNumberEdit.val().charAt(0) == '0' && userContactNumberEdit.val().charAt(1) == '9' && userContactNumberEdit.val().length == 11){
                if(confirm('update Contact Number?') == true){
                    updateApprovedUserModal.modal('hide');
                    loadingScreen.show();
                    $.ajax({
                        type: 'POST',
                        url: 'php/updateUserContactNumber.php',
                        data:
                        {
                            requestId: globalProductId,
                            contact_number: userContactNumberEdit.val(),
                        },
                        success:function(response){
                            if(response == 'success'){
                                userContactNumberEdit.val("");
                                approvedUsersTable.children().remove();
                                getApprovedUsers();
                                loadingScreen.slideUp('fast');
                            }else{
                                loadingScreen.slideUp('fast', function(){
                                    alert('Server Error!')
                                });
                            }
                        }
                    });
                }
            }
        });
        
        function getApprovedUsers(){
            $.ajax({
                type: 'POST',
                url: 'php/getApprovedUsers.php',
                success:function(response){
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        approvedUsersTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.updated_at}</td>
                                <td>
                                    <button class="editApprovedUserBtn btn positive-btn" value="${value.id}" data-bs-toggle="modal" data-bs-target="#updateApprovedUserModal">Update</button>
                                    <button class="terminateApprovedUserBtn btn negative-btn" value="${value.id}">Terminate</button>
                                </td>
                            </tr>
                        `);
                    });
                    var ediApprovedUserBtn = $('.editApprovedUserBtn');
                    var terminateApprovedUserBtn = $('.terminateApprovedUserBtn');
                    
                    ediApprovedUserBtn.click(function(){
                        globalProductId = $(this).val();
                    });
                    
                    terminateApprovedUserBtn.click(function(){
                        if(confirm('Terminate This Account?') == true){
                            var thisBtn = $(this);
                            loadingScreen.show();
                            globalProductId = $(this).val();
                            $.ajax({
                                type: 'POST',
                                url: 'php/terminateApprovedUser.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Account Terminated.');
                                            thisBtn.parent().parent().remove();
                                        });
                                    }else{
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                            
                        }
                    });
                }
            });
        }
        
        function getUserRequests(){
                $.ajax({
                type: 'POST',
                url: 'php/getUsers.php',
                success: function(response){
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        userTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.created_at}</td>
                                <td>
                                    <button class="approveRequestBtn btn positive-btn" value="${value.id}">Approve</button>
                                    <button class="declineRequestBtn btn negative-btn" value="${value.id}">Decline</button>
                                </td>
                            </tr>
                        `);
                    });
                    var approveRequestBtn = $('.approveRequestBtn');
                    var declineRequestBtn = $('.declineRequestBtn');

                    approveRequestBtn.click(function(){
                        if(confirm('Approve this Request?') == true){
                            var thisButton = $(this);
                            globalProductId = $(this).val();
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/approveRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeU.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeU.text(counter);
                                            }else{
                                                badgeU.text("");
                                            }
                                            alert('Request Approved.');
                                            thisButton.parent().parent().remove();
                                        });
                                    }else{
                                        loadingScreen.hide('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }

                            });
                        }
                    });
                    declineRequestBtn.click(function(){
                        globalProductId = $(this).val();
                        var thisButton = $(this);
                        if(confirm('Decline Request?') == true){
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/declineRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeU.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeU.text(counter);
                                            }else{
                                                badgeU.text("");
                                            }
                                            alert('Request Deleted.');
                                            thisButton.parent().parent().remove();
                                        });
                                    }else{
                                        loadingScreen.hide('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
            });
        };
        function getMechanics(){
            $.ajax({
                type: 'POST',
                url: 'php/getMechanics.php',
                success:function(response){
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        approvedMechanicsTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.updated_at}</td>
                                <td>
                                    <button class="editApprovedMechanicBtn btn positive-btn" value="${value.id}" data-bs-toggle="modal" data-bs-target="#updateApprovedMechanicsModal">Update</button>
                                    <button class="terminateApprovedMechanicBtn btn negative-btn" value="${value.id}">Terminate</button>
                                </td>
                            </tr>
                        `);
                    });
                    var editApprovedMechanicBtn = $('.editApprovedMechanicBtn');
                    var terminateApprovedMechanicBtn = $('.terminateApprovedMechanicBtn');
                    
                    editApprovedMechanicBtn.click(function(){
                        globalProductId = $(this).val();
                    });
                    
                    terminateApprovedMechanicBtn.click(function(){
                        if(confirm('Terminate Mechanic?') == true){
                            globalProductId = $(this).val();
                            var thisButton =$(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/terminateApprovedMechanic.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            thisButton.parent().parent().remove();
                                            alert('Mechanic Terminated.');
                                        })
                                    }else{
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Server Error!');
                                        })
                                    }
                                }
                            });
                        }
                    }); 
                }
            });
        }
        function getMechanicsRequest(){
            $.ajax({
                type: 'POST',
                url: 'php/getRequestMechanics.php',
                success:function(response){
                    console.log(response);
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        requestMechanicsTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.created_at}</td>
                                <td>
                                    <button class="approveMechanicRequestBtn btn positive-btn" value="${value.id}">Approve</button>
                                    <button class="declineMechanicRequestBtn btn negative-btn" value="${value.id}">Decline</button>
                                </td>
                            </tr>
                        `);
                    });
                    var approveMechanicRequestBtn = $('.approveMechanicRequestBtn');
                    var declineMechanicRequestBtn = $('.declineMechanicRequestBtn');
                    
                    approveMechanicRequestBtn.click(function(){
                        if(confirm('Approve This Request?') == true){
                            globalProductId = $(this).val();
                            var thisButton = $(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/approveMechanicRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeM.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeM.text(counter);
                                            }else{
                                                badgeM.text("");
                                            }
                                            thisButton.parent().parent().remove();
                                            alert('Request Approved.');
                                        });
                                    }else{
                                        loadingScreen.hide('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                    declineMechanicRequestBtn.click(function(){
                        if(confirm('Decline Request?') == true){
                            globalProductId = $(this).val();
                            var thisButton = $(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/declineMechanicRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeM.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeM.text(counter);
                                            }else{
                                                badgeM.text("");
                                            }
                                            thisButton.parent().parent().remove();
                                            alert('Request Deleted.');
                                        });
                                    }else{
                                        loadingScreen.hide('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
            });
        }
        function getShopOwners(){
            $.ajax({
                type: 'POST',
                url: 'php/getShopOwners.php',
                success:function(response){
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        approvedShopOwnersTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.updated_at}</td>
                                <td>
                                    <button class="editApprovedShopOwnerBtn btn positive-btn" value="${value.id}" data-bs-toggle="modal" data-bs-target="#updateApprovedShopOwnerModal">Update</button>
                                    <button class="terminateApprovedShopOwnerBtn btn negative-btn" value="${value.id}">Terminate</button>
                                </td>
                            </tr>
                        `);
                    });
                    var editApprovedShopOwnerBtn = $('.editApprovedShopOwnerBtn');
                    var terminateApprovedShopOwnerBtn =$('.terminateApprovedShopOwnerBtn');
                    
                    editApprovedShopOwnerBtn.click(function(){
                        globalProductId = $(this).val();
                    });
                    terminateApprovedShopOwnerBtn.click(function(){
                        if(confirm('Terminate Shop Owner?') == true){
                            globalProductId = $(this).val();
                            var thisButton = $(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/terminateShopOwner.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            thisButton.parent().parent().remove();
                                            alert('Shop Owner Terminated.');
                                        });
                                    }else{
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
            });
        }
        function getShopOwnersRequests(){
            $.ajax({
                type: 'POST',
                url: 'php/getShopOwnersRequest.php',
                success:function(response){
                    var data = JSON.parse(response);
                    $(data).each(function(index,value){
                        shopOwnersRequestTable.append(`
                            <tr>
                                <td>${value.last_name}, ${value.first_name}</td>
                                <td>${value.email}</td>
                                <td>${value.contact_number}</td>
                                <td>${value.created_at}</td>
                                <td>
                                    <button class="approveShopOwnerRequestBtn btn positive-btn" value="${value.id}">Approve</button>
                                    <button class="declineShopOwnerRequestBtn btn negative-btn" value="${value.id}">Decline</button>
                                </td>
                            </tr>
                        `);
                    });
                    var approveShopOwnerRequestBtn = $('.approveShopOwnerRequestBtn');
                    var declineShopOwnerRequestBtn = $('.declineShopOwnerRequestBtn');
                    
                    approveShopOwnerRequestBtn.click(function(){
                        if(confirm('Approve This Request?') == true){
                            globalProductId = $(this).val();
                            var thisButton = $(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/approveShopOwnerRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeSO.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeSO.text(counter);
                                            }else{
                                                badgeSO.text("");
                                            }
                                            thisButton.parent().parent().remove();
                                            alert('Request Approved.');
                                        });
                                    }else{
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                    declineShopOwnerRequestBtn.click(function(){
                        if(confirm('Decline Request?') == true){
                            globalProductId = $(this).val();
                            var thisButton = $(this);
                            loadingScreen.show();
                            $.ajax({
                                type: 'POST',
                                url: 'php/declineShopOwnerRequest.php',
                                data:
                                {
                                    requestId: globalProductId,
                                },
                                success:function(response){
                                    if(response == 'success'){
                                        loadingScreen.slideUp('fast', function(){
                                            var counter = parseInt(badgeSO.text());
                                            counter--;
                                            if(counter != 0){
                                                badgeSO.text(counter);
                                            }else{
                                                badgeSO.text("");
                                            }
                                            thisButton.parent().parent().remove();
                                            alert('Request Deleted.');
                                        });
                                    }else{
                                        loadingScreen.slideUp('fast', function(){
                                            alert('Server Error!');
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
            });
        };
        function popperso(){
            $.ajax({
                type: 'POST',
                url: 'php/SOcounter.php',
                success:function(response){
                    if(response != 0){
                        inboxSO = response;
                        badgeSO.text(inboxSO);
                    }
                }
            });
        }
        function popperm(){
            $.ajax({
                type: 'POST',
                url: 'php/Mcounter.php',
                success:function(response){
                    if(response != 0){
                        inboxM = response;
                        badgeM.text(inboxM);
                    }
                }
            });
        }
        function popperu(){
            $.ajax({
                type: 'POST',
                url: 'php/Ucounter.php',
                success:function(response){
                    if(response != 0){
                        inboxU = response;
                        badgeU.text(inboxU);
                    }
                }
            });
        }
        getUserRequests();
        popperso();
        popperm();
        popperu();
        
        navShopOwners.click(function(){
            approvedUserSection.slideUp('fast');
            userSection.slideUp('fast');
            mechanicsSection.slideUp('fast');
            requestMechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideUp('fast');
            shopOwnersSection.slideDown('slow');
            approvedShopOwnersTable.children().remove();
            getShopOwners();
        });
        navShopOwnersRequests.click(function(){
            shopOwnersRequestTable.children().remove();
            approvedUserSection.slideUp('fast');
            userSection.slideUp('fast');
            mechanicsSection.slideUp('fast');
            requestMechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideDown('slow');
            shopOwnersSection.slideUp('fast');
            getShopOwnersRequests();
            popperso();
        });
        navRequestMechanics.click(function(){
            requestMechanicsTable.children().remove();
            approvedUserSection.slideUp('fast');
            userSection.slideUp('fast');
            mechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideUp('fast');
            shopOwnersSection.slideUp('fast');
            requestMechanicsSection.slideDown('slow');
            getMechanicsRequest();
            popperm();
        });
        navMechanics.click(function(){
            approvedMechanicsTable.children().remove();
            approvedUserSection.slideUp('fast');
            userSection.slideUp('fast');
            mechanicsSection.slideDown('slow');
            requestMechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideUp('fast');
            shopOwnersSection.slideUp('fast');
            getMechanics();
        })
        navAccountRequests.click(function(){
            userTable.children().remove();
            approvedUserSection.slideUp('fast');
            mechanicsSection.slideUp('fast');
            userSection.slideDown('slow');
            requestMechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideUp('fast');
            shopOwnersSection.slideUp('fast');
            getUserRequests();
            popperu();
        });
        navApprovedAccounts.click(function(){
            approvedUsersTable.children().remove();
            userSection.slideUp('fast');
            mechanicsSection.slideUp('fast');
            approvedUserSection.slideDown('slow');
            requestMechanicsSection.slideUp('fast');
            shopOwnersRequestSection.slideUp('fast');
            shopOwnersSection.slideUp('fast');
            getApprovedUsers();
        });
        
        logoutButton.click(function(){
            if(confirm('Are You Sure?') == true){
                loadingScreen.show();
                $.ajax({
                    type: 'POST',
                    url: 'php/logout.php',
                    success:function(response){
                        if( response == "index.html"){
                            loadingScreen.slideDown('fast', function(){
                                window.location.replace(response);
                            });
                        }
                    }
                })
            }
        });
        
        
        
        
        
        loadingScreen.hide();
    });
</script>
<style>
    #loader{
        animation: loader 1.3s;
        animation-iteration-count: infinite;
        animation-timing-function: linear;
    }
    @keyframes loader{
        to{
            transform: rotate(360deg);
        }
    }
    .tthh{
        background: rgb(0,0,0);
        background: linear-gradient(144deg, rgba(0,0,0,1) 3%, rgba(255,201,0,1) 3%, rgba(255,201,0,1) 9%, rgba(0,0,0,1) 9%, rgba(0,0,0,1) 17%, rgba(255,201,0,1) 17%, rgba(255,201,0,1) 25%, rgba(0,0,0,1) 25%, rgba(0,0,0,1) 35%, rgba(255,201,0,1) 35%, rgba(255,201,0,1) 43%, rgba(0,0,0,1) 43%, rgba(0,0,0,1) 53%, rgba(255,201,0,1) 53%, rgba(255,201,0,1) 61%, rgba(0,0,0,1) 61%, rgba(0,0,0,1) 71%, rgba(255,201,0,1) 71%, rgba(255,201,0,1) 79%, rgba(0,0,0,1) 79%, rgba(0,0,0,1) 88%, rgba(255,201,0,1) 88%, rgba(255,201,0,1) 96%, rgba(0,0,0,1) 96%);
        color: white;
    }
    body{
        min-height: 100vh;background: rgb(14,32,52);background: linear-gradient(34deg, rgba(14,32,52,1) 10%, rgba(44,56,71,1) 14%, rgba(53,63,77,1) 20%, rgba(12,38,87,1) 29%, rgba(2,32,89,1) 46%, rgba(99,129,255,1) 53%, rgba(73,99,192,1) 64%, rgba(16,33,52,1) 73%, rgba(58,68,81,1) 100%);
    }
    main{
        margin-bottom: 50px;
    }
    .positive-btn{
        background-color: darkblue;
        color: white;
        transition-duration: 0.2s;
    }
    .positive-btn:hover{
        background-color: blue;
        color: white;
    }
    .negative-btn{
        background-color: white;
        color: darkblue;
        border-color: darkblue;
        transition-duration: 0.2s;
    }
    .negative-btn:hover{
        background-color: blue;
        color: white;
    }.badge{
        font-size: 8px;
    }
</style>
<body>
   <!-- loading screen -->
    <div class="loadingScreen" style="position: absolute;z-index: 99;width: 100%;height: 100vh;background-color: rgba(0,0,0,0.5);display: flex;align-items: center;justify-content: center;">
       <img id="loader" src="logo.png" alt="TAR logo" class="img-fluid" style="width: auto; max-height: 50px">
   </div>
   <header class="sticky-top shadow-lg" style="z-index: 90;border-bottom: solid 2.5px rgba(0,0,0,0.8);background-color: darkblue;">
       <nav class="navbar navbar-expand-lg navbar-dark py-0">
            <div class="container my-0">
                <div class="navbar-brand m-0">
                    <h1 style="font-family: fantasy;color: white;">
                        <img src="logo.png" height="70px" width="70px" alt="">Tap And Repair
                    </h1>
                </div>
                <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div id="nav-menu" class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto">
                     <li class="nav-item dropdown mt-2">
                            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false"><sup class="badge text-light rounded-pill m-0 p-1" id="badgeSO" style="background-color: red;"></sup><img src="shopicon.png"  height="16px" width="16px" alt="">Shop Owners
                            </a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="#" id="navShopOwners">Approved Shop Owners</a></li>
                              <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="#" id="navShopOwnersRequests">Shop Owners Requests</a></li>
                            </ul>
                       </li>
                      <li class="nav-item dropdown mt-2">
                            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false"><sup class="badge text-light rounded-pill m-0 p-1" id="badgeM" style="background-color: red;"></sup><img src="smallwrench.png"  height="16px" width="16px" alt="">Mechanics</a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="#" id="navMechanics">Approved Mechanics</a></li>
                              <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="#" id="navRequestMechanics">Request Mechanics</a></li>
                            </ul>
                       </li>
                       <li class="nav-item dropdown mt-2">
                            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false"><sup class="badge text-light rounded-pill m-0 p-1" id="badgeU" style="background-color: red;"></sup><img src="person.svg"alt="">Accounts</a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="#" id="navApprovedAccounts">Approved Accounts</a></li>
                              <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="navAccountRequests">Requests</a></li>
                            </ul>
                       </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link mx-3">
                                <button class="btn text-light" id="logOut">
                                    <img src="door-open.svg" alt="logout">Log Out
                                </button>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
   </header>
   <main>
       <section id="userSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">
                            Account Requests:
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Requested</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="userTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
       <section id="approvedUserSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">Approved Accounts:</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Approved</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="approvedUserTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
       <section id="mechanicsSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">Approved Mechanics:</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Approved</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="approvedMechanicsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
       <section id="requestMechanicsSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">Request Mechanics:</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Requested</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="requestMechanicsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
       <section id="shopOwnersSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">Approved Shop Owners:</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Approved</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="approvedShopOwnersTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
       <section id="shopOwnersRequestSection">
            <div class="container">
                <div class="card mt-5 rounded-5 shadow">
                    <div class="card-header">
                        <h4 class="fw-bold my-3 mx-5">Shop Owners Requests:</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <th scope="col">Name</th>
                                    <th scope="col">E-mail Address</th>
                                    <th scope="col">Contact Number</th>
                                    <th scope="col">Date Requested</th>
                                    <th scope="col">Operations</th>
                                </thead>
                                <tbody id="shopOwnersRequestTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
       </section>
   </main>
   <footer></footer>
   <div class="modal fade" id="updateApprovedUserModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <div class="modal-title justify-content-between">
                        <h4>Update User Information</h4>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <div style="display: flex;">
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="userFirstNameEdit" placeholder="First Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                            <div>
                                <span style="margin: 10px"></span>
                            </div>
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="userLastNameEdit" placeholder="Last Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                        </div>
                        <button id="userNameUpdateBtn" class="btn btn-md btn-success mt-2">Update Name</button>
                    </div>
                    <hr>
                    <div>
                        <input type="Email" class="form-control mt-3" id="userEmailEdit" placeholder="Email Address">
                        <div class="invalid-feedback">Please Fill up this field</div>
                        <button id="userEmailUpdateBtn" class="btn btn-md btn-success mt-2">Update Email</button>
                    </div>
                    <hr>
                    <div>
                        <input type="number" class="form-control mt-3" id="userContactNumberEdit" placeholder="Contact Number">
                        <div class="invalid-feedback">Invalid Contact Number</div>
                        <button id="userContactNumberUpdateBtn" class="btn btn-md btn-success mt-2">Update Contact Number</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="updateApprovedMechanicsModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <div class="modal-title justify-content-between">
                        <h4>Update Mechanic Information</h4>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <div style="display: flex;">
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="mechanicFirstNameEdit" placeholder="First Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                            <div>
                                <span style="margin: 10px"></span>
                            </div>
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="mechanicLastNameEdit" placeholder="Last Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                        </div>
                        <button id="mechanicNameUpdateBtn" class="btn btn-md btn-success mt-2">Update Name</button>
                    </div>
                    <hr>
                    <div>
                        <input type="Email" class="form-control mt-3" id="mechanicEmailEdit" placeholder="Email Address">
                        <div class="invalid-feedback">Please Fill up this field</div>
                        <button id="mechanicEmailUpdateBtn" class="btn btn-md btn-success mt-2">Update Email</button>
                    </div>
                    <hr>
                    <div>
                        <input type="number" class="form-control mt-3" id="mechanicContactNumberEdit" placeholder="Contact Number">
                        <div class="invalid-feedback">Invalid Contact Number</div>
                        <button id="mechanicContactNumberUpdateBtn" class="btn btn-md btn-success mt-2">Update Contact Number</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="updateApprovedShopOwnerModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <div class="modal-title justify-content-between">
                        <h4>Update Shop Owner Information</h4>
                    </div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <div style="display: flex;">
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="ownerFirstNameEdit" placeholder="First Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                            <div>
                                <span style="margin: 10px"></span>
                            </div>
                            <div>
                                <input style="width: 100%;margin-right: 100%;" type="text" class="form-control mt-3" id="ownerLastNameEdit" placeholder="Last Name">
                                <div class="invalid-feedback">Please Fill up this field</div>
                            </div>
                        </div>
                        <button id="ownerNameUpdateBtn" class="btn btn-md btn-success mt-2">Update Name</button>
                    </div>
                    <hr>
                    <div>
                        <input type="Email" class="form-control mt-3" id="ownerEmailEdit" placeholder="Email Address">
                        <div class="invalid-feedback">Please Fill up this field</div>
                        <button id="ownerEmailUpdateBtn" class="btn btn-md btn-success mt-2">Update Email</button>
                    </div>
                    <hr>
                    <div>
                        <input type="number" class="form-control mt-3" id="ownerContactNumberEdit" placeholder="Contact Number">
                        <div class="invalid-feedback">Invalid Contact Number</div>
                        <button id="ownerContactNumberUpdateBtn" class="btn btn-md btn-success mt-2">Update Contact Number</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>